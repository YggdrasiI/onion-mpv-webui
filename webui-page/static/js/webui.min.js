const DEBUG=!1,DEBUG_MOBILE=!1,DEBUG_TOUCH=!1,USE_DUMMY_AUDIO_ELEMENT=!1,USE_SWIPES=!0,UNIT_GAP=" ",REGEXS={brackets:new RegExp("\\[[^\\]]*\\]","g"),extension:new RegExp("[.][A-z]{3,10}$",""),checksumBeforeExtension:new RegExp("-[A-z0-9-]{10,12}([.][A-z]+)$",""),cleanup_dots:new RegExp("[.…]*…[.…]*","g")};let ws=null,mpv_status={},mpv_outstanding_status={delay:300,updates:{},timer:null,pending:!1};var metadata={},subs={},audios={},videos={},connected=!1,max_title_size=60,tab_in_background=!1,prevActiveElement=null,block={posSlider:null,volSlider:null,active:function(e){return null!==this[e]},enable:function(e){this[e]&&clearTimeout(this[e]),this[e]=!1},disable:function(e){!1===this[e]&&(this[e]=setTimeout((function(){window.block[e]=null}),this.timeout_ms))},timeout_ms:300,doublePause:!1};function get_diff(e,t,n){for(var s=e.length,i=t.length,a=[],o=0,r=0;o<s&&r<i;)n(e[o],t[r])?(++o,++r):e[o+1]&&t[r+1]&&n(e[o+1],t[r+1])?(a.push({op:"replace",new:o,old:r}),o+=2,r+=2):e[o+1]&&n(e[o+1],t[r])?(a.push({op:"add",new:o,old:r}),o+=2,r+=1):t[r+1]&&n(e[o],t[r+1])?(a.push({op:"remove",new:-1,old:r}),o+=1,r+=2):(a.push({op:"replace",new:o,old:r}),o+=1,r+=1);for(;r<i;)a.push({op:"remove",new:-1,old:r}),++r;for(;o<s;)a.push({op:"add",new:o,old:i}),++o,++i;return a}function basename(e){var t=e.split("/");return(t=t.filter((e=>e)))[t.length-1]}function send_ws(e,...t){let n={command:String(e),param1:null==t[0]?"":String(t[0]),param2:null==t[1]?"":String(t[1])};if(void 0!==t[2]&&!0!==t[2]||(n.param1=encodeURIComponent(n.param1),n.param2=encodeURIComponent(n.param2)),ws){let e=`${n.command}/${n.param1}/${n.param2}`;ws.send(e)}}function send(e,t,n,s){return send_ws(e,t,n,s)}function send_url_input(e,t){let n=document.getElementById("playlistAdd_input"),s=n.value;s?(send("playlist_add","append",s,!1),n.value=""):!0===t&&n.select()}function format_time(e){var t=new Date(null);return t.setSeconds(e),t.toISOString().substr(11,8)}function format_time2(e){let t=["-","","+"][Math.sign(e)+1],n=Math.abs(e);if(n<60)return`${t}${n} s`;let s=`${t}${Math.floor(n/60)} min`;return 0!=n%60&&(s=`${s} ${n%60} s`),s}function playlist_get_title(e){return e.hasOwnProperty("title")?e.title:basename(e.filename)}function check_idle(e){return"yes"==(e.idle||"")&&-1===current_playlist_index(e.playlist)}function decode(e){return e=(e=(e=e.replaceAll("&#39;","'").replaceAll("&quot;",'"')).replaceAll("&lt;","<").replaceAll("&gt;",">")).replaceAll("&amp;","&")}function encodeResolveDifference(e){const t=Array.from("#$&+,/:;=?@");let n={};t.forEach((e=>{n[e]=encodeURIComponent(e)}));const s=RegExp("["+Object.keys(n)+"]","g");return console.log(Object.keys(n)),e.replace(s,(function(e,t,s){return n[e]}))}function encode_raw_link(e){var t=new URL(e,window.location);return t.pathname=encodeURIComponent(decodeURI(t.href.slice(1+t.origin.length))),t.href}function preserve_special_chars(e){return e.replaceAll("%","%25").replaceAll("+","%2B").replaceAll(" ","%20")}function sanitize(e){const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;","`":"&grave;"};return e.replace(/[&<>"'/`]/gi,(e=>t[e]))}function unfold_bindings(e){const t=e.reduce(((e,t)=>{const n=!!t.shift;return e[n]=e[n]||[],e[n].push(t),e}),{});return{false:Object.assign({},Object.groupBy(t[!1],(e=>e.code)),Object.groupBy(t[!1],(e=>e.key))),true:Object.assign({},Object.groupBy(t[!0],(e=>e.code)),Object.groupBy(t[!0],(e=>e.key)))}}class KeyBindings{static bindings=[{key:" ",code:32,command:"toggle_pause"},{key:"ArrowRight",code:39,command:"seek",param1:"5"},{key:"ArrowLeft",code:37,command:"seek",param1:"-5"},{key:"ArrowUp",code:38,command:"seek",param1:"60"},{key:"ArrowDown",code:40,command:"seek",param1:"-60"},{key:"ArrowRight",code:39,shift:!0,command:"seek",param1:"1"},{key:"ArrowLeft",code:37,shift:!0,command:"seek",param1:"-1"},{key:"ArrowUp",code:38,shift:!0,command:"seek",param1:"5"},{key:"ArrowDown",code:40,shift:!0,command:"seek",param1:"-5"},{key:"PageDown",code:34,command:"seek",param1:"3"},{key:"PageUp",code:33,command:"seek",param1:"-3"},{key:"f",code:70,command:"fullscreen"},{key:"n",code:78,command:"playlist_next"},{key:"p",code:80,command:"playlist_prev"},{key:"Backspace",code:8,command:"reset_playback_speed"},{key:"9",code:57,command:"add_volume",param1:"-2"},{key:"0",code:48,command:"add_volume",param1:"2"},{key:"Escape",code:27,handle:function(e){hide_overlays()}},{key:"Enter",code:13,handle:function(e){show_next_overlay()}},{key:"m",code:58,command:"toggle_mute"}];static bindings2=unfold_bindings(this.bindings);static for_event(e){const t=this.bindings2[e.shiftKey][e.keyCode]||this.bindings2[e.shiftKey][e.key];return void 0===t?null:Object.assign(new KeyBindings,t[0])}}function webui_keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;if("Unidentified"==e.key)return;let t=KeyBindings.for_event(e);if(null!==t){if("input"===document.activeElement.localName||"select"===document.activeElement.localName){if("range"!==document.activeElement.type)return;if([37,38,39,40].includes(e.keyCode))return}t.handle&&t.handle(e),t.command&&send(t.command,t.param1,t.param2),(t.handle||t.command)&&(e.stopPropagation(),e.preventDefault())}}const options={swap_short_and_long_press:!0,update_default_entry:!0,default_entry_in_menu:!0,show_silbing_menu:!0},sibling_ids={seekBack1:["seekForward1"],seekForward1:["seekBack1"]};var longpress={options:{ms:400},done:null,timer:null,_abortLongpress:function(){longpress.timer&&(clearTimeout(longpress.timer),longpress.timer=null)},addEventHandler:function(e,t,n,s){if(0!=e.length){void 0===n&&(n=null),void 0===s&&(s=null),options.swap_short_and_long_press&&null!==s&&([n,s]=[s,n]),null!==s&&!t in["mouseup","pointerup"]&&console.log("Warning, touchmenu defined for event != mouseup/pointerup.Element: "+(e[0].getAttribute("id")||e[0].getAttribute("name")));var i=function(e){touchmenu._hidden&&(!0!==longpress.done?(longpress._abortLongpress(),longpress.done=!1,n(e)):longpress.done=null)};if(e.forEach((e=>{e.addEventListener(t,i)})),null!==s){let t=function(e){var t;touchmenu._hidden&&(longpress.done=null,longpress.timer=setTimeout((t=e.currentTarget,function(){if(longpress.timer=null,!1===longpress.done)return void(longpress.done=null);longpress.done=!0;let e=new CustomEvent("longpress",{});t.dispatchEvent(e)}),longpress.options.ms))},n=function(e){longpress._abortLongpress()};e.forEach((e=>{e.addEventListener("longpress",s),e.addEventListener("touchstart",t),e.addEventListener("mousedown",t),e.addEventListener("touchend",n),e.addEventListener("mouseup",n)}))}}}},touchmenu={options:{catch_events_outside:!0,id_prefix:"touchmenu",seek_menu_entries:{seekBack1:[-5,-30,-60,-180,-600,-1800],seekForward1:[10,30,60,180,600,1800]}},_touchstart_in_menu:!1,_touchmove_in_menu:!1,_menu_handler_initialized:{},_resize_handler:{},_hidden:!0,_recently_open:!1,_max_number_open_menus:0,_menu_ids:[],_avoid_menu_hide:function(e){touchmenu._touchstart_in_menu||(touchmenu._touchstart_in_menu=!0)},_skip_touchend_handler:function(e){touchmenu._touchmove_in_menu||(touchmenu._touchmove_in_menu=!0)},_menu_innerHeights:{},_update_innerHeight:!1,_gen_menu_elements:function(){let e=[],t=0;if(options.show_silbing_menu){t=Object.values(sibling_ids).reduce(((e,t)=>Math.max(e,t.length)),0);for(let n=0;n<=t;n++)e.push(`${this.options.id_prefix}${n}`)}else t=1,e.push(`${this.options.id_prefix}0`);[].slice.call(e).forEach((function(e){menu=document.createElement("div"),menu.id=e,menu.classList.add("touchmenu"),menu.style.cssText="\n        position: absolute;\n        display:none;\n        ",document.getElementsByTagName("body")[0].appendChild(menu)})),this._max_number_open_menus=t,this._menu_ids=e},_getSiblingTargets:function(e){var t=sibling_ids[e];return t?t.map((e=>document.getElementById(e))):[]},_get_element:function(e){return 0===this._menu_ids.length&&this._gen_menu_elements(),e?document.getElementById(this._menu_ids[e]):document.getElementById(this._menu_ids[0])},show:function(e){this._recently_open=!0,this._hidden=!1,lock_slider_state(!0),e||(e=this._get_element()),e.style.setProperty("display","block")},hide:function(e){e?e.style.setProperty("display","none"):this._hidden||(this._hidden=!0,lock_slider_state(!1),options.show_silbing_menu&&this._menu_ids.map((e=>document.getElementById(e))).forEach((e=>e.style.setProperty("display","none"))))},_prepare:function(e,t,n){n.sibling=n.sibling||!1,n.expand=n.expand||{},n.preferBottomOffset=n.preferBottomOffset||0,n.during_resize=n.during_resize||!1,!1===this._menu_handler_initialized.hasOwnProperty(e.id)&&(e.addEventListener("pointerdown",this._avoid_menu_hide),e.addEventListener("touchmove",this._skip_touchend_handler),this._menu_handler_initialized[e.id]=!0),this._menu_innerHeights[e]=window.innerHeight,this._touchstart_in_menu=!1,this._touchmove_in_menu=!1,e.style.setProperty("display","none"),e.replaceChildren();var s=this._position(e,t,n),i={preferBottomOffset:n.preferBottomOffset,expand:n.expand,above:s,during_resize:!0};return n.sibling||(Object.values(this._resize_handler).forEach((e=>window.removeEventListener("resize",e))),this._resize_handler={}),this._resize_handler[e.id]=function(n){touchmenu._update_innerHeight&&(touchmenu._update_innerHeight=!1,Object.keys(touchmenu._menu_innerHeights).forEach((e=>{touchmenu._menu_innerHeights[e]=window.innerHeight}))),touchmenu._position(e,t,i)},window.addEventListener("resize",this._resize_handler[e.id]),s},_position:function(e,t,n){n.expand=n.expand||{},n.preferBottomOffset=n.preferBottomOffset||0;const s=t.getBoundingClientRect(),i=n.during_resize?0:window.innerHeight-touchmenu._menu_innerHeights[e];if(n.expand.left){const t=n.expand.left.getBoundingClientRect();e.style.setProperty("left",Math.round(t.left+window.scrollX)+"px")}else e.style.setProperty("left",Math.round(s.left+window.scrollX)+"px");if(n.expand.right){const t=n.expand.right.getBoundingClientRect();e.style.setProperty("right",Math.round(window.innerWidth-t.right-window.scrollX)+"px")}else e.style.setProperty("right",Math.round(window.innerWidth-s.right-window.scrollX)+"px");if(n.above||void 0===n.above&&s.top>window.innerHeight-s.bottom+n.preferBottomOffset){var a=!0;e.style.removeProperty("top"),e.style.setProperty("bottom",Math.round(window.innerHeight-s.top-window.scrollY-i)+"px")}else{a=!1;e.style.setProperty("top",Math.round(s.bottom+window.scrollY+i)+"px"),e.style.removeProperty("bottom")}return a},_add_entry:function(e,t,n,s,i){var a=document.createElement("li");if(a.classList.add("touchmenu-entry"),s<0)a.innerText=t;else{var o=document.createElement("span");o.classList.add("index");var r=document.createElement("span");o.innerText=`#${s}`,r.innerText=t,a.appendChild(o),a.appendChild(r)}a.addEventListener("click",n),e.appendChild(a)},_add_info:function(e,t){var n=document.createElement("li");n.classList.add("touch-info"),n.innerText=t,e.appendChild(n)},_fill_ul:function(e,t,n){var s=document.createElement("ul");t?s.style.setProperty("flex-direction","column-reverse"):s.style.setProperty("flex-direction","column"),n.forEach((e=>{this._add_entry(s,e[0],e[1],e[2],e[3])})),e.appendChild(s),s.children.length>0&&(t?(this.show(e),s.children[0].scrollIntoView({alignToTop:!1})):s.children[0].scrollIntoView({alignToTop:!0}))},_target(e,t){let n=e.currentTarget;return t.sibling&&(n=this._getSiblingTargets(n.id)[t.sibling-1]),n},next_files:function(e,t){t=t||{};let n=this._target(e,t);if(!n)return;var s=this._get_element(t.sibling);t.preferBottomOffset=100,t.expand={left:document.getElementById("playlistPrev")};const i=this._prepare(s,n,t),a=mpv_status.playlist||[],o=current_playlist_index(a)+1,r=Math.min(o+15,a.length);if(0==a.length||o==a.length)this._add_info(s,"No further entries");else{add_entry_args=[];for(let e=o;e<r;++e)add_entry_args.push([playlist_get_title(a[e]),function(e){return function(t){send("playlist_jump",e),send("play")}}(e),e+1,[o,r]]);this._fill_ul(s,i,add_entry_args)}this.show(s),options.show_silbing_menu&&!t.sibling&&(t.sibling=1,t.above=!i,this.prev_files(e,t))},prev_files:function(e,t){t=t||{};let n=this._target(e,t);if(!n)return;var s=this._get_element(t.sibling);t.preferBottomOffset=0,t.expand={right:document.getElementById("playlistNext")};const i=this._prepare(s,n,t),a=mpv_status.playlist||[],o=current_playlist_index(a),r=Math.max(0,o-15);if(0==a.length||r>o)this._add_info(s,"No previous entries");else{add_entry_args=[];for(let e=o;e>=r;--e)add_entry_args.push([playlist_get_title(a[e]),function(e){return function(t){send("playlist_jump",e),send("play")}}(e),e+1,[r,o]]);this._fill_ul(s,i,add_entry_args)}this.show(s),options.show_silbing_menu&&!t.sibling&&(t.sibling=1,t.above=!i,this.next_files(e,t))},next_chapters:function(e,t){t=t||{};let n=this._target(e,t);if(!n)return;var s=this._get_element(t.sibling);t.preferBottomOffset=100,t.expand={left:document.getElementById("chapterBack")};const i=this._prepare(s,n,t),a=mpv_status["chapter-list"]||[],o=current_chapter_index(mpv_status)+1,r=Math.min(o+100,a.length);if(o>=a.length)this._add_info(s,"No further entries");else{add_entry_args=[];for(let e=o;e<r;++e)add_entry_args.push([chapter_get_title(a,e),function(e){return function(t){send("set_chapter",e)}}(e),e+1,[o,r]]);this._fill_ul(s,i,add_entry_args)}this.show(s),options.show_silbing_menu&&!t.sibling&&(t.sibling=1,t.above=!i,this.prev_chapters(e,t))},prev_chapters:function(e,t){t=t||{};let n=this._target(e,t);if(!n)return;var s=this._get_element(t.sibling);t.preferBottomOffset=100,t.expand={right:document.getElementById("chapterForward")};const i=this._prepare(s,n,t),a=mpv_status["chapter-list"]||[],o=current_chapter_index(mpv_status),r=Math.max(0,o-100);if(0==a.length)this._add_info(s,"No previous entries");else{add_entry_args=[];for(let e=o;e>=r;--e)add_entry_args.push([chapter_get_title(a,e),function(e){return function(t){send("set_chapter",e)}}(e),e+1,[r,o]]);this._fill_ul(s,i,add_entry_args)}this.show(s),options.show_silbing_menu&&!t.sibling&&(t.sibling=1,t.above=!i,this.next_chapters(e,t))},list_subtitle:function(e,t){t=t||{};let n=this._target(e,t);if(!n)return;var s=this._get_element(t.sibling);t.preferBottomOffset=0;const i=this._prepare(s,n,t),a=mpv_status["track-list"];add_entry_args=[];for(let e=0;e<a.length;e++)if("sub"===a[e].type){var o=a[e].id;add_entry_args.push([(r=a[e],r.hasOwnProperty("title")?r.title:r.hasOwnProperty("lang")?r.lang:r.hasOwnProperty("codec")?r.codec:""),function(e){return function(t){send("set_subtitle",e)}}(o),o,[0,window.subs.count]])}var r;add_entry_args.length>0&&add_entry_args.push(["No subtitle",function(e){send("set_subtitle",0)},-1,[0,window.subs.count]]),this._fill_ul(s,i,add_entry_args),this.show(s),options.show_silbing_menu&&!t.sibling&&(t.sibling=1,this.list_video(e,t),t.sibling=2,this.list_audio(e,t))},list_video:function(e,t){t=t||{};let n=this._target(e,t);if(!n)return;var s=this._get_element(t.sibling);t.preferBottomOffset=0;const i=this._prepare(s,n,t),a=mpv_status["track-list"];add_entry_args=[];for(let e=0;e<a.length;e++)if("video"===a[e].type){var o=a[e].id;add_entry_args.push([(r=a[e],r.hasOwnProperty("title")?r.title:r.hasOwnProperty("demux-w")?`${r["demux-w"]}x${r["demux-h"]}`:r.hasOwnProperty("codec")?r.codec:r.hasOwnProperty("decoder-desc")?r.decoder-desc:r.hasOwnProperty("lang")?r.lang:""),function(e){return function(t){send("set_video",e)}}(o),o,[0,window.videos.count]])}var r;this._fill_ul(s,i,add_entry_args),this.show(s),options.show_silbing_menu&&!t.sibling&&(t.sibling=1,this.list_audio(e,t),t.sibling=2,this.list_subtitle(e,t))},list_audio:function(e,t){t=t||{};let n=this._target(e,t);if(!n)return;var s=this._get_element(t.sibling);t.preferBottomOffset=0;const i=this._prepare(s,n,t),a=mpv_status["track-list"];add_entry_args=[];for(let e=0;e<a.length;e++)if("audio"===a[e].type){var o=a[e].id;add_entry_args.push([(r=a[e],r.hasOwnProperty("title")?r.title:r.hasOwnProperty("lang")?r.lang:r.hasOwnProperty("demux-samplerate")?r.demux-samplerate:r.hasOwnProperty("codec")?r.codec:r.hasOwnProperty("decoder-desc")?r.decoder-desc:""),function(e){return function(t){send("set_subtitle",e),send("play")}}(o),o,[0,window.audios.count]])}var r;this._fill_ul(s,i,add_entry_args),this.show(s),options.show_silbing_menu&&!t.sibling&&(t.sibling=1,this.list_subtitle(e,t),t.sibling=2,this.list_video(e,t))},seek_menu:function(e,t){t=t||{};let n=this._target(e,t);if(!n)return;let s=this.options.seek_menu_entries[n.id],i=0;options.default_entry_in_menu||(i=Number(n.getAttribute("seek"))||0);var a=this._get_element(t.sibling);t.preferBottomOffset=0;const o=this._prepare(a,n,t);add_entry_args=[];for(let e=0;e<s.length;e++){if(s[e]===i)continue;let t=format_time2(s[e]);add_entry_args.push([t,function(e,t){return function(s){send("seek",e),options.update_default_entry&&update_seek_button(n,e,t)}}(s[e],t),-1,[0,s.length]])}this._fill_ul(a,o,add_entry_args),a.children[0].style.setProperty("text-align","center"),this.show(a),options.show_silbing_menu&&!t.sibling&&(t.sibling=1,t.above=o,this.seek_menu(e,t))}};function observeEventsForTouchmenu(e){if(touchmenu.options.catch_events_outside&&!touchmenu._hidden&&!touchmenu._touchstart_in_menu){if(touchmenu._recently_open)return e.stopPropagation(),void("click"==e.type&&(touchmenu._recently_open=!1));e.stopPropagation(),"click"==e.type&&touchmenu.hide()}}function hideTouchMenu(e){if(!touchmenu._hidden)return touchmenu._touchstart_in_menu?(touchmenu._touchstart_in_menu=!1,void(touchmenu._touchmove_in_menu=!1)):void touchmenu.hide()}function lock_slider_state(e){var t=document.getElementsByClassName("slider");!0===e?[].slice.call(t).forEach((function(e){e.style.setProperty("pointer-events","none")})):[].slice.call(t).forEach((function(e){e.style.removeProperty("pointer-events")}))}function update_seek_button(e,t,n){e.setAttribute("seek",t),e.getElementsByTagName("LABEL")[0].innerText=n}function setFullscreenButton(e){if("yes"===e)var t="Fullscreen off";else t="Fullscreen on";document.getElementById("fullscreenButton").children[0].innerText=t}function updatePlayPauseButton(e){var t=document.getElementsByClassName("playPauseButton");"yes"==e?[].slice.call(t).forEach((function(e){e.innerHTML='<i class="fas fa-play"></i>'})):[].slice.call(t).forEach((function(e){e.innerHTML='<i class="fas fa-pause"></i>'}))}function update_sort_buttons(){function e(e,t){var n=document.getElementsByClassName(e),s=[];return[].slice.call(n).forEach((function(e){var n=e.getElementsByClassName(t);s=s.concat(Array.from(n))})),s}for(let s in sortings){var t=sortings[s],n=t.active;DEBUG_SORTINGS&&console.log(`Change Icon from ${s} to ${n}`);t.dirs.length,t.dirs.length;e("shareSortButton_"+s,"fas").forEach((function(e){e.classList.remove(...t.icons),e.classList.add(t.icons[n])}))}}function playlist_loop_cycle(){var e=document.getElementsByClassName("playlistLoopButton")[0].getAttribute("value");"no"===e?(send("loop_file","inf"),send("loop_playlist","no")):"1"===e?(send("loop_file","no"),send("loop_playlist","inf")):"a"===e&&(send("loop_file","no"),send("loop_playlist","no"))}function add_button_listener(){[["togglePlayPause","click",function(e){togglePlayPause()}],["playlistLoopCycle","click",function(e){playlist_loop_cycle()}],["playlistShuffle","click",function(e){send("playlist_shuffle")}],["togglePlaylist","click",function(e){togglePlaylist()}],["share_selector","change",function(e){share_change(e.target)}],["shareSortingAlpha","click",function(e){share_change_sorting("alpha"),sortShareList()}],["shareSortingDate","click",function(e){share_change_sorting("date"),sortShareList()}],["browseShares","click",function(e){browseShares()}],["toggleShares","click",function(e){toggleShares()}],["playlistPrev","pointerup",function(e){send("playlist_prev")},function(e){touchmenu.prev_files(e)}],["playlistNext","pointerup",function(e){send("playlist_next")},function(e){touchmenu.next_files(e)}],["seekBack1","pointerup",function(e){send("seek",e.target.getAttribute("seek")||"-5")},function(e){touchmenu.seek_menu(e)}],["seekForward1","pointerup",function(e){send("seek",e.target.getAttribute("seek")||"10")},function(e){touchmenu.seek_menu(e)}],["seekBack2","pointerup",function(e){send("seek","-60")}],["seekForward2","pointerup",function(e){send("seek","120")}],["chapterBack","pointerup",function(e){send("add_chapter","-1")},function(e){touchmenu.prev_chapters(e)}],["chapterForward","pointerup",function(e){send("add_chapter","1")},function(e){touchmenu.next_chapters(e)}],["playbackSpeed1","pointerup",function(e){send("increase_playback_speed","0.9")}],["playbackSpeed2","pointerup",function(e){send("increase_playback_speed","1.1")}],["playbackSpeedReset","click",function(e){setPlaybackSpeedButtons(1),send("reset_playback_speed")}],["subDelay1","pointerup",function(e){send("add_sub_delay","-0.05")}],["subDelay2","pointerup",function(e){send("add_sub_delay","0.05")}],["audioDelay1","pointerup",function(e){send("add_audio_delay","-0.05")}],["audioDelay2","pointerup",function(e){send("add_audio_delay","0.05")}],["toggleFullscreen","click",function(e){send("fullscreen")}],["cycleAudioDevice","pointerup",function(e){send("cycle","audio-device")}],["cycleSub","pointerup",function(e){send("cycle","sub")},function(e){touchmenu.list_subtitle(e)}],["cycleAudio","pointerup",function(e){send("cycle","audio")},function(e){touchmenu.list_audio(e)}],["cycleVideo","pointerup",function(e){send("cycle","video")},function(e){touchmenu.list_video(e)}],["mediaPosition","change",function(e){send("set_position",e.currentTarget.value),window.block.disable("posSlider")}],["mediaPosition","input",function(e){window.block.enable("posSlider");var t=e.currentTarget;document.getElementById("position").innerText=format_time(t.value)}],["mediaVolume","change",function(e){send("set_volume",e.currentTarget.value),window.block.disable("volSlider")}],["mediaVolume","input",function(e){window.block.enable("volSlider");var t=e.currentTarget;document.getElementById("volume").innerText=t.value+"%"}],["playlistAdd_btn","click",function(e){send_url_input(e,!0)}],["playlistAdd_input","keyup",function(e){"Enter"===e.key&&send_url_input(e,!1)}],["quitMpv","click",function(e){send("quit")}]].forEach((e=>{let t=elementsByNameOrId(e[0]);0==t.length&&console.log(`No button named '${e[0]}' found to add event!`),window.longpress?longpress.addEventHandler(t,e[1],e[2],e[3]):t.forEach((t=>{t.addEventListener(e[1],e[2])}))}))}function audioLoad(){}function audioPlay(){}function audioPause(){}function _overlay_switch(e){return function(t){let n=e[t.detail.dir];void 0!==n&&n(t),t.cancelBubble=!0}}function add_overlay_swipes(e){let t=Object.keys(overlays),n=t.length;if(!(n<2)){t.push(t[0]),t.unshift(t[n-1]);for(let i=1;i<n+1;++i){if(e&&e!==t[i])continue;function s(e,n){let s=overlays[t[e]],i=overlays[t[n]];return function(){s(!1),i(!0)}}let a={};const o=2;overlays[t[i]]===toggleShares?(a.left=function(e){e.detail.fingers>=o?cycle_share(1):s(i,i-1)()},a.right=function(e){e.detail.fingers>=o?cycle_share(-1):s(i,i+1)()},a.down=function(){share_change_dir("."),share_change(document.getElementById("share_selector"))}):(a.left=s(i,i-1),a.right=s(i,i+1)),document.getElementById(t[i]).addEventListener("swiped",_overlay_switch(a)),document.getElementById(t[i]).addEventListener("mousedown",(function(e){1==e.button&&s(i,i+1)()}),!0)}}}function add_main_swipes(){let e={up:function(e){show_next_overlay()}};e.down=e.up,document.getElementsByTagName("BODY")[0].addEventListener("swiped",_overlay_switch(e))}function togglePlaylist(e){return toggleOverlay("overlay1",e)}function createPlaylistTable(e,t,n,s){function i(e){!0===e?(d.innerHTML='<i class="fas fa-play"></i>',d.classList.add("active"),c.classList.add("active")):(d.replaceChildren(),d.classList.remove("active"),c.classList.remove("active"))}if(e.title)var a=e.title;else{a=basename(e.filename);a=decodeURIComponent(a)}var o=trim_title_string(a,max_title_size),r=document.createElement("table"),l=document.createElement("tr"),d=document.createElement("td"),c=document.createElement("td"),u=document.createElement("td");r.className="playlist",r.playlist_id=t,l.className="playlist",c.className="playlist",d.className="playlist",u.className="playlist",c.innerText=o,c.setAttribute("title",a);var p=document.createElement("td");if(p.innerHTML='<i class="fas fa-arrow-up"></i>',p.className="playlist",u.innerHTML='<i class="fas fa-trash"></i>',e.hasOwnProperty("playing"))d.innerHTML="yes"===n?'<i class="fas fa-pause"></i>':'<i class="fas fa-play"></i>',d.classList.add("playing","violet"),c.classList.add("playing","violet"),p.classList.add("violet"),u.classList.add("violet"),d.addEventListener("click",(()=>{togglePlayPause()}));else{d.classList.add("gray"),c.classList.add("gray"),p.classList.add("gray"),u.classList.add("gray"),d.addEventListener("click",(()=>{!function(e){send("playlist_jump",e.playlist_id),send("play")}(r)})),d.addEventListener("mouseenter",(function(){i(!0)})),d.addEventListener("mouseleave",(function(){i(!1)})),d.addEventListener("click",(function(){d.classList.add("click"),c.classList.add("click"),setTimeout((function(){d.classList.remove("click"),c.classList.remove("click")}),100)}))}return p.addEventListener("click",function(e){return function(){send("playlist_move_up",e.playlist_id)}}(r)),u.addEventListener("click",function(e){return function(){send("playlist_remove",e.playlist_id)}}(r)),l.appendChild(d),l.appendChild(c),l.appendChild(p),l.appendChild(u),r.appendChild(l),r}function populatePlaylist(e,t){var n=document.getElementById("playlist");n.replaceChildren();var s=!0,i=null;for(let a=0;a<e.length;++a){let o=createPlaylistTable(e[a],a,t,s);n.appendChild(o),!0===s&&(s=!1),e[a].hasOwnProperty("playing")&&(i=o)}i&&i.scrollIntoView({block:"center"})}function updatePlaylistOnPause(e,t,n){if(t!=n){var s=document.getElementById("playlist");for(let n=0;n<e.length;++n)if(e[n].current&&1==e[n].current){let i=createPlaylistTable(e[n],n,t,0==n);s.replaceChild(i,s.children[n]);break}}}function updatePlaylist(e,t,n){var s=get_diff(e,t,(function(e,t){return e.filename==t.filename&&e.current==t.current})),i=document.getElementById("playlist"),a=i.parentElement,o=0;s.forEach((t=>{if("replace"==t.op){var s=createPlaylistTable(e[t.new],t.old,n,0==t.new);i.replaceChild(s,i.children[t.old+o])}else if("add"==t.op){s=createPlaylistTable(e[t.new],t.old,n,0==t.new);i.insertBefore(s,i.children[t.old+o]),o++}else"remove"==t.op&&(i.removeChild(i.children[t.old+o]),o--)}));var r=0;if(i.childNodes.forEach((e=>{e.playlist_id=r++})),"hidden"===a.style.getPropertyValue("visibility")){var l=current_playlist_index(e);l>=0&&i.children[l].scrollIntoView({block:"center"})}}window.addEventListener("click",observeEventsForTouchmenu,{capture:!0}),window.addEventListener("mouseup",observeEventsForTouchmenu,{capture:!0}),window.addEventListener("pointerup",observeEventsForTouchmenu,{capture:!0}),window.addEventListener("touchend",observeEventsForTouchmenu,{capture:!0}),window.addEventListener("click",hideTouchMenu,{capture:!1}),screen.orientation.addEventListener("change",(e=>{touchmenu._update_innerHeight=!0})),window.addEventListener("load",audioLoad,!1);let delayed_chapter_marks=!1;function updateCapterMarks(e,t,n,s,i,a){var o=document.getElementById("chapter_marker");if(0===e)o.style.backgroundImage="none";else{if(-1==t&&a<.1)return void(delayed_chapter_marks=!0);var r=[];for(let e=0;e<s.length;e++){const t=(1e3*s[e].time/i).toFixed(2);r.push(`<use xlink:href="%23markB" x="${t}" width="50" height="100%" />\\`)}o.style.backgroundImage=`url('data:image/svg+xml,\\\n<svg version="1.1" \\\nxmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" \\\nwidth="1100" height="auto" preserveAspectRatio="none">\\\n<defs>\\\n<symbol id="markB" \\\nviewBox="0 0 50 200" \\\npreserveAspectRatio="xMidYMid" \\\n>\\\n<polygon \\\npoints="24,49 0,0 49,0, 25,49, 25,150, 49,199, 0,199, 24,150" \\\nfill="rgba(200,30,30, 0.3)" \\\nstroke="%23555544" stroke-width="1" vector-effect="non-scaling-stroke"\\\n/>\\\n</symbol>\\\n</defs>\\\n<g transform="translate(25 0)">\\\n    ${r.join("\n")}\n</g>\\\n</svg>')`}}function checkForStatusUpdate(e){if(e&&!window.connected&&!window.tab_in_background)return clearTimeout(mpv_outstanding_status.restart),void status_init_ws();if(mpv_outstanding_status.pending){var t=function(){if(tab_in_background)mpv_outstanding_status.timer=setTimeout(t,mpv_outstanding_status.delay);else{mpv_outstanding_status.timer=null;var e=mpv_outstanding_status.updates;mpv_outstanding_status.updates={},handleStatusUpdate(e)}};e?(clearTimeout(mpv_outstanding_status.timer),t()):0==mpv_outstanding_status.delay?t():null==mpv_outstanding_status.timer&&(mpv_outstanding_status.timer=setTimeout(t,mpv_outstanding_status.delay))}}function setTrackList(e){window.audios.selected=0,window.audios.count=0,window.subs.selected=0,window.subs.count=0,window.videos.selected=0,window.videos.count=0;for(let t=0;t<e.length;t++)"audio"===e[t].type?(window.audios.count++,e[t].selected&&(window.audios.selected=e[t].id)):"sub"===e[t].type?(window.subs.count++,e[t].selected&&(window.subs.selected=e[t].id)):"video"===e[t].type&&(window.videos.count++,e[t].selected&&(window.videos.selected=e[t].id));var t=document.getElementById("nextSub");window.subs.count>0?(t.innerText="Sub "+window.subs.selected+"/"+window.subs.count,displayElementClass("subtitle",!0)):(displayElementClass("subtitle",!1),t.innerText="No subtitle");t=document.getElementById("nextVideo");window.videos.count>1||window.videos.count>0&&0==window.videos.selected?(t.innerText="Video "+window.videos.selected+"/"+window.videos.count,displayElementClass("video",!0)):(displayElementClass("video",!1),0==window.videos.count&&(t.innerText="No video"));t=document.getElementById("nextAudio");window.audios.count>1||window.audios.count>0&&0==window.audios.selected?(t.innerText="Audio "+window.audios.selected+"/"+window.audios.count,displayElementClass("audio2",!0),displayElementClass("audio1",!0)):(displayElementClass("audio2",!1),1==window.audios.count?(displayElementClass("audio1",!0),t.innerText="Audio "+window.audios.selected+"/"+window.audios.count):(displayElementClass("audio1",!1),t.innerText="No audio"))}function current_chapter_index(e){return e.hasOwnProperty("chapter")?e.chapter:-1}function chapter_get_title(e,t){return e[t].hasOwnProperty("title")?e[t].title:"Chapter "+t}function current_playlist_index(e){for(let t=0;t<e.length;t++)if(e[t].hasOwnProperty("current"))return t;return-1}function print_idle(){var e="Idle…";window.metadata.title=e,window.metadata.artist="",window.metadata.album="",document.getElementById("title").innerText=window.metadata.title,document.getElementById("title").setAttribute("title",e),document.getElementById("artist").innerText=window.metadata.artist,document.getElementById("album").innerText=window.metadata.album}function setMetadata(e,t,n,s){e=e||{};var i="";if(check_idle(s))return print_idle();e.track&&(i=e.track+" - ");var a=current_playlist_index(t);if(a>=0&&t[a].title)var o=t[a].title;else if(e.title)o=i+e.title;else if(e.TITLE)o=i+e.TITLE;else o=i+basename(n);window.metadata.title=trim_title_string(o,max_title_size),e.artist?window.metadata.artist=e.artist:window.metadata.artist="",e.album?window.metadata.album=e.album:window.metadata.album="",document.getElementById("title").innerText=window.metadata.title,document.getElementById("title").setAttribute("title",o),document.getElementById("artist").innerText=window.metadata.artist,document.getElementById("album").innerText=window.metadata.album}function setPosSlider(e,t,n,s){var i=document.getElementById("mediaPosition"),a=document.getElementById("position");i.max=t,window.block.active("posSlider")||(i.value=e,Math.round(e)!=Math.round(n)&&(a.innerText=format_time(i.value)))}function setVolumeSlider(e,t){var n=document.getElementById("mediaVolume"),s=document.getElementById("volume");window.block.active("volSlider")||(n.value=e,n.max=t),s.innerText=n.value+"%"}function setPlayPause(e){null===e&&(document.getElementById("audio").paused,e="yes"),updatePlayPauseButton(e),"mediaSession"in navigator&&("yes"==e?audioPause():audioPlay())}function __mediaSession(){"mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata({title:window.metadata.title,artist:window.metadata.artist,album:window.metadata.album,artwork:[{src:"/favicons/android-chrome-192x192.png",sizes:"192x192",type:"image/png"},{src:"/favicons/android-chrome-512x512.png",sizes:"512x512",type:"image/png"}]}),navigator.mediaSession.setActionHandler("play",(function(){send("play")})),navigator.mediaSession.setActionHandler("pause",(function(){send("pause")})),navigator.mediaSession.setActionHandler("seekbackward",(function(){send("seek","-5")})),navigator.mediaSession.setActionHandler("seekforward",(function(){send("seek","10")})),navigator.mediaSession.setActionHandler("previoustrack",(function(){send("playlist_prev")})),navigator.mediaSession.setActionHandler("nexttrack",(function(){send("playlist_next")})),navigator.mediaSession.setPositionState({duration:mpv_status.duration,position:Math.max(0,Math.min(mpv_status["time-pos"],mpv_status.duration)),playbackRate:mpv_status.speed}),"pause"in mpv_status&&"yes"==mpv_status.pause?navigator.mediaSession.playbackState="paused":navigator.mediaSession.playbackState="playing")}function togglePlayPause(){var e=mpv_status.pause;null===e&&(e=document.getElementById("audio").paused?"yes":"no"),"yes"==e?audioPlay():audioPause(),send("toggle_pause")}function setChapter(e,t,n){var s=document.getElementById("chapterContent"),i="";(t<-1||t>=e)&&(t=0),null!==n&&(n.title?i=n.title:n.TITLE&&(i=n.TITLE)),0===e?(displayElementClass("chapter",!1),displayElementClass("no_chapter",!0),s.innerText="0/0"):(displayElementClass("chapter",!0),displayElementClass("no_chapter",!1),s.innerText=t+1+"/"+e+" "+i)}function setPlaybackSpeedButtons(e){if(window.metadata.speed!=e){window.metadata.speed=e;var t=document.getElementById("playbackSpeedReset");showInfoForControls(t,["playbackSpeed1","playbackSpeed2"],!(!e||1==e))}}function setSubDelay(e){var t=document.getElementById("subDelayInfo");if(0==e)showInfoForControls(t,["subDelay1","subDelay2"],!1);else{const n=parseInt(1e3*e);t.innerText=(n>0?"+":"")+n+"ms",showInfoForControls(t,["subDelay1","subDelay2"],!0)}}function setAudioDelay(e){var t=document.getElementById("audioDelayInfo");if(0==e)showInfoForControls(t,["audioDelay1","audioDelay2"],!1);else{const n=parseInt(1e3*e);t.innerText=(n>0?"+":"")+n+"ms",showInfoForControls(t,["audioDelay1","audioDelay2"],!0)}}function setLoop(e,t){var n=document.getElementsByClassName("playlistLoopButton"),s='<i class="fas fa-redo-alt"></i>',i="";"no"===e?"no"===t?(s='!<i class="fas fa-redo-alt"></i>',i="no"):(s='<i class="fas fa-redo-alt"></i>Σ',i="a"):(s='<i class="fas fa-redo-alt"></i>1',i="1"),[].slice.call(n).forEach((function(e){e.innerHTML=s,e.setAttribute("value",i)}))}function handleStatusResponse(e){setMetadata(e.metadata,e.playlist,e.filename,e),setTrackList(e["track-list"]),document.getElementById("duration").innerText=format_time(e.duration),document.getElementById("playtime-remaining").innerText="-"+format_time(e["playtime-remaining"]),setPlaybackSpeedButtons(e.speed),e.speed&&(document.getElementById("speed").innerText=1!=e.speed?`(x ${Number(e.speed).toFixed(2)})`:""),setSubDelay(e["sub-delay"]),setAudioDelay(e["audio-delay"]),setPlayPause(e.pause),setPosSlider(e["time-pos"],e.duration,-1,-1),setVolumeSlider(e.volume,e["volume-max"]),setLoop(e["loop-file"],e["loop-playlist"]),setFullscreenButton(e.fullscreen),setChapter(e.chapters,e.chapter,e["chapter-metadata"]),populatePlaylist(e.playlist,e.pause),"mediaSession"in navigator&&setupNotification(),updateCapterMarks(e.chapters,e.chapter,e["chapter-metadata"],e["chapter-list"],e.duration,e["time-pos"])}function handleStatusUpdate(e){let t=Object.assign({},mpv_status,e);mpv_outstanding_status.pending=!1,("metadata"in e||"playlist"in e||"filename"in e)&&setMetadata(t.metadata,t.playlist,t.filename,t),"track-list"in e&&setTrackList(t["track-list"]),"duration"in e&&(document.getElementById("duration").innerText=format_time(t.duration)),"speed"in e&&(setPlaybackSpeedButtons(t.speed),t.speed!=mpv_status.speed&&(document.getElementById("speed").innerText=1!=t.speed?`(x ${Number(t.speed).toFixed(2)})`:"")),"playtime-remaining"in e&&Math.round(t["playtime-remaining"])!=Math.round(mpv_status["playtime-remaining"])&&(document.getElementById("playtime-remaining").innerText="-"+format_time(t["playtime-remaining"])),"sub-delay"in e&&setSubDelay(t["sub-delay"]),"audio-delay"in e&&setAudioDelay(t["audio-delay"]),("time-pos"in e||"duration"in e)&&setPosSlider(t["time-pos"],t.duration,mpv_status["time-pos"],mpv_status.duration),("volume"in e||"volume-max"in e)&&setVolumeSlider(t.volume,t["volume-max"]),("loop-file"in e||"loop-playlist"in e)&&setLoop(t["loop-file"],t["loop-playlist"]),"fullscreen"in e&&setFullscreenButton(t.fullscreen),("chapters"in e||"chapter"in e||"chapter-metadata"in e)&&setChapter(t.chapters,t.chapter,t["chapter-metadata"]),"chapter"in e&&-1==mpv_status.chapter||"chapters"in e?updateCapterMarks(t.chapters,t.chapter,t["chapter-metadata"],t["chapter-list"],t.duration,t["time-pos"]):delayed_chapter_marks&&t["time-pos"]>=.1&&(delayed_chapter_marks=!1,updateCapterMarks(t.chapters,t.chapter,t["chapter-metadata"],t["chapter-list"],t.duration,t["time-pos"])),"playlist"in e&&(updateNotification(t),updatePlaylist(t.playlist,mpv_status.playlist,t.pause)),"pause"in e&&(setPlayPause(t.pause),updateNotification(t),updatePlaylistOnPause(t.playlist,t.pause,mpv_status.pause)),("metadata"in e||"filename"in e)&&updateNotification(t),mpv_status=t}function status_init_ws(){ws=new WebSocket("ws://"+window.location.host+"/ws"),ws.__unhandled_data=[],ws.onmessage=function(e){try{metadata=[(e.data.charCodeAt(1)<<8)+e.data.charCodeAt(0),(e.data.charCodeAt(3)<<8)+e.data.charCodeAt(2)]}catch(t){return console.log(t.name+": "+t.message),void console.log("Input: "+e.data)}if(0==metadata[1]&&ws.__unhandled_data.length>0&&(console.log("Websocket communication error. New set of chunks begins,but previous one was not completed?!"),console.log("Old data:\n"+ws.__unhandled_data),console.log("New data:\n"+e.data.slice(4)),console.log("New Metadata: chunks/id= "+metadata[0]+"/"+metadata[1]),ws.__unhandled_data=[]),1==metadata[0])ws.oncompletejson(e.data.slice(4));else if(ws.__unhandled_data[metadata[1]]=e.data.slice(4),ws.__unhandled_data.length==metadata[0]){var t=ws.__unhandled_data.join("");ws.__unhandled_data=[],ws.oncompletejson(t)}},ws.oncompletejson=function(e){try{var t=JSON.parse(e)}catch(t){return console.log(t.name+": "+t.message),void console.log("Input: "+e)}if("status_info"in t){var n=t.status_info;n.connection||console.log("Websocket error on connection:"+n),"page_title"in n&&(document.title=n.page_title)}"status"in t&&(mpv_status=t.status,handleStatusResponse(mpv_status)),"status_diff"in t&&(Object.assign(mpv_outstanding_status.updates,t.status_diff),mpv_outstanding_status.pending=!0,checkForStatusUpdate(!1))},ws.onopen=function(e){connected=!0},ws.onclose=function(e){connected&&(connected=!1,1001!=e.code&&(clearTimeout(mpv_outstanding_status.timer),print_disconnected(),hide_overlays())),window.tab_in_background||(mpv_outstanding_status.restart=setTimeout((function(){console.log("Try reconnecting websocket"),status_init_ws()}),5e3)),ws=null}}function print_disconnected(){document.getElementById("title").innerHTML="<span class='info'>Not connected to MPV!</span>",document.getElementById("artist").innerText="",document.getElementById("album").innerText="",setPlayPause("yes")}function setupNotification(){__mediaSession()}function trim_title_string(e,t,n,s){return arguments.length<4&&(s="…"),arguments.length<3&&(n="…"),(e=(e=e.replace(REGEXS.brackets,n)).replace(REGEXS.checksumBeforeExtension,RegExp.$1)).length>t&&(e=e.replace(REGEXS.extension,s)),e.length>t&&(e=e.substr(0,t)).charAt(e.length-1)!=s&&(e=e.concat(s)),e=e.replace(REGEXS.cleanup_dots,n)}function setClass(e,t,n){arguments.length<3&&(n="hidden"),1==t?e.classList.remove(n):e.classList.add(n)}function displayElementClass(e,t,n){arguments.length<3&&(n="hidden");let s=document.getElementsByClassName(e);[].slice.call(s).forEach((function(e){setClass(e,t,n)}))}function __changeControls(e,t,n,s){setClass(e,n,"hidden"),t.forEach((e=>{setClass(document.getElementById(e),!n,s),document.getElementsByName(e).forEach((e=>{setClass(e,!n,s)}))}))}function showMiddleControl(e,t,n){__changeControls(elMidle,t,n,"with_mid")}function showInfoForControls(e,t,n){__changeControls(e,t,n,"with_info")}function updateNotification(e){"mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata({title:window.metadata.title,artist:window.metadata.artist,album:window.metadata.album,artwork:[{src:"/favicons/android-chrome-192x192.png",sizes:"192x192",type:"image/png"},{src:"/favicons/android-chrome-512x512.png",sizes:"512x512",type:"image/png"}]}),navigator.mediaSession.setPositionState({duration:e.duration,position:Math.max(0,Math.min(e["time-pos"],e.duration)),playbackRate:e.speed}),"pause"in e&&"yes"==e.pause?navigator.mediaSession.playbackState="paused":navigator.mediaSession.playbackState="playing")}function logging_in_page(){var e=document.createElement("div");e.style.cssText="\n    position: absolute;\n    top:0em; left:0em;\n    width:90%; height: 20%;\n    background-color:rgba(0,0,0,0.8);\n    color:lightgrey;\n    z-index: 1002; overflow:scroll;\n  ",console.log=function(t){if("object"==typeof t)(n=JSON.stringify(t)).length>100&&(n=n.substr(0,99)+"…");else var n=t.valueOf();e.innerHTML+="<br />"+n,e.scrollTo({top:1e4})},e.addEventListener("dblclick",(function(e){this.innerHTML=""})),e.addEventListener("touchstart",(function(e){2==e.targetTouches.length&&(this.innerHTML="")})),document.getElementsByTagName("body")[0].appendChild(e)}function elementsByNameOrId(e){return document.querySelectorAll(`[name=${e}], #${e}`)}function init(){Object.assign(overlays,{overlay1:togglePlaylist,overlay2:toggleShares}),status_init_ws(),add_button_listener(),add_main_swipes()}document.addEventListener("visibilitychange",(function(e){document.hidden?tab_in_background=!0:(tab_in_background=!1,checkForStatusUpdate(!0))})),window.addEventListener("keydown",webui_keydown,!0),window.addEventListener("load",init,!1);var lastTouchEnd=0;document.addEventListener("touchend",(function(e){var t=(new Date).getTime();t-lastTouchEnd<=300&&e.preventDefault(),lastTouchEnd=t}),!1);var overlays={},id_prev=void 0;function hide_overlays(){for(id in overlays){var e=document.getElementById(id);e&&"visible"===e.style.visibility&&overlays[id](!1)}}function show_overlay(e){overlays[e](!0)}function hide_overlay(e){overlays[e](!1)}function show_next_overlay(){let e,t;for(id in overlays){if(void 0===e&&(e=id),void 0!==t){e=id;break}let n=document.getElementById(id);n&&"visible"===n.style.visibility&&(t=id)}void 0===t&&null!=id_prev&&(e=id_prev),t&&hide_overlay(t),e&&show_overlay(e)}function toggleOverlay(e,t){let n=document.getElementById(e),s=t||"visible"!==n.style.getPropertyValue("visibility");if(document.body.classList.toggle("noscroll",s),n.style.setProperty("visibility",s?"visible":"hidden"),s||(id_prev=e),!n.hasOwnProperty("close_event_registered")){n.addEventListener("click",(function(t){t.stopPropagation();let s=document.prevActiveElement;var i,a;document.prevActiveElement=null,"select"===document.activeElement.localName||s||((i=t.target)==(a=n)||i.parentElement==a&&0==i.childElementCount)&&toggleOverlay(e,!1)}),!1),n.close_event_registered=!0,i=n,Array.from(i.getElementsByTagName("input")).forEach((e=>e.addEventListener("focusout",(function(e){document.prevActiveElement=e.target})))),add_overlay_swipes(e)}var i;return s}const DEBUG_SORTINGS=!1;var sortings={alpha:{dirs:[-1,1,2,-2],icons:["fa-sort-alpha-up","fa-sort-alpha-down","fa-folder-open","fa-folder-open"],active:0},date:{dirs:[-1,1],icons:["fa-sort-numeric-up","fa-sort-numeric-down"],active:0}},shares={list:null,sorting:null,selected:null,close_event_registered:!1,scroll_positions:{},local_sorting:{}};function toggleShares(e){let t=toggleOverlay("overlay2",e);return t&&null==shares.list&&refresh_share_list(),t}function browseShares(){var e=`/media/html/${`${basename(shares.list[shares.selected].url)}/${shares.list[shares.selected].dir}`}`;e=e.replace(/[/]+$/gm,""),console.log(`Open ${e}`),window.open(e,window.metadata.title).focus()}function share_change(e){var t=document.getElementById("sharelist"),n=shares.scroll_positions.active_dirpath;if(void 0!==n){var s=t.scrollTop;if(shares.scroll_positions[n]=s,shares.sorting){var i=shares.sorting.sname;DEBUG_SORTINGS&&console.log(`Save sorting ${shares.sorting.sname} ${sortings[i].active}`),shares.local_sorting[n]={sname:shares.sorting.sname,active:sortings[i].active}}}var a=e.selectedIndex,o=new XMLHttpRequest;if(-1==a)o.open("get","/media/api/list/.current/.current");else{var r=shares.list[e.selectedIndex];o.open("get",r.url+"/"+r.dir)}o.onreadystatechange=function(){if(4===o.readyState&&200===o.status){var e=JSON.parse(o.responseText);update_selected_share(e),print_share_list(e)}else o.status},o.send(null)}function cycle_share(e){var t=document.getElementById("share_selector");const n=t.options.length;t.selectedIndex=(n+t.selectedIndex+e)%n,share_change(t)}function update_selected_share(e){shares.selected=-1;for(let n=0;n<shares.list.length;++n){var t=`${e.commands.list}/${e.dirpath}`;if(console.log(`${t} vs ${shares.list[n].url}`),t.startsWith(shares.list[n].url)){shares.selected=n,document.getElementById("share_selector").options.selectedIndex=n;break}}-1==shares.selected&&(console.log("Error. Given path is no child directory of a share."),shares.selected=0,0==shares.list.length)||shares.selected&&".current"===shares.list[shares.selected].dir&&(shares.list[shares.selected].dir=share_get_subdir(e.dirpath))}function share_change_dir(e){if("."===e){e=shares.list[shares.selected].url+"/"+shares.list[shares.selected].dir}if(".."===e){let t=shares.list[shares.selected].url+"/"+shares.list[shares.selected].dir.replace(/[/]+$/gm,""),n=basename(t);e=t.substring(0,t.length-n.length)}"/"===e&&(e=shares.list[shares.selected].url+"/"),console.log(`Link of new share dir: '${e}'`);let t=share_get_subdir(e);console.log(`Relative dir of new share dir: '${t}'`),shares.list[shares.selected].dir=t}function share_get_subdir(e){var t=shares.list[shares.selected].url;return e.startsWith(t)?e.replace(t,"").replace(/^[/]+|[/]+$/gm,""):""}function share_add_file(e,t){if(".."!==e){e=t?e.replace("playlist_add","playlist_add/replace"):e.replace("playlist_add","playlist_add/append");var n=new XMLHttpRequest;n.open("get",e),n.onreadystatechange=function(){if(4===n.readyState&&200===n.status)JSON.parse(n.responseText);else 0===n.status&&console.log("Adding file to playlist failed")},n.send(null)}}function print_share_list(e){var t=document.getElementById("sharelist"),n=t.parentElement;n.removeChild(t);try{t.replaceChildren();function s(e,t){var n=-1==e.size,s=document.createElement("LI"),i=document.createElement("I"),a=document.createElement("SPAN"),o=decode(e.play||""),r=decode(e.list||"");function l(e,t,n){var s=n?"fa-folder":"fa-file";t?e.classList.replace(s,"fa-play"):e.classList.replace("fa-play",s)}if(s.classList.add("gray"),i.classList.add(t>=0?"share_bullet":"share_bullet_dotdot"),n?i.classList.add("fas","fa-folder"):i.classList.add("fas","fa-file"),a.textContent=e.name||decodeURIComponent(basename(o)),n?(a.classList.add("share_dir"),a.addEventListener("click",(function(){share_change_dir(r),share_change(document.getElementById("share_selector"))})),t>=0&&i.addEventListener("click",(function(){share_add_file(o,!0)}))):(a.classList.add("share_file"),t>=0&&(a.addEventListener("click",(function(){share_add_file(o,!1)})),i.addEventListener("click",(function(){share_add_file(o,!0)})))),t>=0&&(i.addEventListener("mouseenter",(function(){l(i,1,n)})),i.addEventListener("mouseleave",(function(){l(i,0,n)}))),s.setAttribute("timestamp",e.modified),s.setAttribute("idx",t),s.isdir=n,s.appendChild(i),s.appendChild(a),t>=0){var d=document.createElement("I");d.classList.add("share_action","fas","fa-plus-square"),d.addEventListener("click",(function(){share_add_file(o,!1)})),s.appendChild(d)}if(-2==t){var c=document.createElement("I");c.classList.add("share_bullet_dotdot","fas","fa-folder");var u=document.createElement("SPAN");u.textContent="/",u.classList.add("share_dir"),u.addEventListener("click",(function(){share_change_dir("/"),share_change(document.getElementById("share_selector"))})),s.appendChild(c),s.appendChild(u)}return s}if(e.dirpath!==shares.list[shares.selected].name_encoded){var i=s({list:"..",play:"..",size:-1,modified:-1},e.dirpath.split("/").length>2?-2:-1);i.classList.add("dir_up"),t.appendChild(i)}var a=e.files;for(let c=0;c<a.length;++c){var o=a[c];o.play=`${e.commands.play}/${e.dirpath}/${o.name_encoded}`,-1==o.size&&(o.list=`${e.commands.list}/${e.dirpath}/${o.name_encoded}`),t.appendChild(s(a[c],c))}var r=shares.local_sorting[e.dirpath];if(void 0!==r)DEBUG_SORTINGS&&console.log(`Restore sorting ${r.sname} ${r.active}`),shares.sorting={sname:r.sname},sortings[r.sname].active=r.active,__sortShareList(t),update_sort_buttons();else if(shares.sorting){var l=shares.sorting.sname;DEBUG_SORTINGS&&console.log(`Use sorting ${l} ${sortings[l].active}`),__sortShareList(t)}}catch(u){console.log(u)}n.appendChild(t);var d=shares.scroll_positions[e.dirpath];t.scrollTop=d||0,shares.scroll_positions.active_dirpath=e.dirpath}function __sortShareList(e){if(null!==shares.sorting){var t=shares.sorting.sname,n=sortings[t];"alpha"===t&&1==n.dirs[n.active]&&Array.from(e.getElementsByTagName("LI")).sort(((e,t)=>Number(e.attributes.idx.value)<0?-1:Number(t.attributes.idx.value)<0?1:e.textContent.localeCompare(t.textContent))).forEach((t=>e.appendChild(t))),"alpha"===t&&-1==n.dirs[n.active]&&Array.from(e.getElementsByTagName("LI")).sort(((e,t)=>Number(e.attributes.idx.value)<0?-1:Number(t.attributes.idx.value)<0?1:-e.textContent.localeCompare(t.textContent))).forEach((t=>e.appendChild(t))),"alpha"===t&&2==n.dirs[n.active]&&Array.from(e.getElementsByTagName("LI")).sort(((e,t)=>{var n=t.isdir-e.isdir;return n||(Number(e.attributes.idx.value)<0?-1:Number(t.attributes.idx.value)<0?1:e.textContent.localeCompare(t.textContent))})).forEach((t=>e.appendChild(t))),"alpha"===t&&-2==n.dirs[n.active]&&Array.from(e.getElementsByTagName("LI")).sort(((e,t)=>{var n=t.isdir-e.isdir;return n||(Number(e.attributes.idx.value)<0?-1:Number(t.attributes.idx.value)<0?1:-e.textContent.localeCompare(t.textContent))})).forEach((t=>e.appendChild(t))),"date"===t&&1==n.dirs[n.active]&&Array.from(e.getElementsByTagName("LI")).sort(((e,t)=>{if(Number(e.attributes.idx.value)<0)return-1;if(Number(t.attributes.idx.value)<0)return 1;var n=Number(e.attributes.timestamp.value);return Number(t.attributes.timestamp.value)-n})).forEach((t=>e.appendChild(t))),"date"===t&&-1==n.dirs[n.active]&&Array.from(e.getElementsByTagName("LI")).sort(((e,t)=>{if(Number(e.attributes.idx.value)<0)return-1;if(Number(t.attributes.idx.value)<0)return 1;var n=Number(e.attributes.timestamp.value);return-(Number(t.attributes.timestamp.value)-n)})).forEach((t=>e.appendChild(t)))}}function sortShareList(){var e=document.getElementById("sharelist");if(null!==e){var t=e.parentElement;t.removeChild(e),__sortShareList(e),t.appendChild(e)}}function share_change_sorting(e){var t=sortings[e];shares.sorting&&shares.sorting.sname===e?t.active=(t.active+1)%t.dirs.length:shares.sorting={sname:e},update_sort_buttons()}function refresh_share_list(){var e=new XMLHttpRequest;e.open("get","/media/api/list"),e.onreadystatechange=function(){4===e.readyState&&200===e.status?function(e){shares.list=[];var t=document.getElementById("share_selector");t.replaceChildren();for(let s in e.shares){shares.list.push({name:s,name_encoded:e.shares[s],url:`${e.commands.list}/${e.shares[s]}`,dir:".current"});var n=document.createElement("option");n.value=e.shares[s],n.text=s,t.appendChild(n)}t.options.selectedIndex=-1,share_change(t)}(JSON.parse(e.responseText)):0===e.status&&console.log("Fetching share list failed")},e.send(null)}
/*!
 * swiped-events.js - v1.3.0
 * Pure JavaScript swipe events
 * https://github.com/john-doherty/swiped-events
 * @inspiration https://stackoverflow.com/questions/16348031/disable-scrolling-when-touch-moving-certain-element
 * @author John Doherty <www.johndoherty.info>
 * @license MIT
 */!function(e,t){"use strict";"function"!=typeof e.CustomEvent&&(e.CustomEvent=function(e,n){n=n||{bubbles:!1,cancelable:!1,detail:void 0};var s=t.createEvent("CustomEvent");return s.initCustomEvent(e,n.bubbles,n.cancelable,n.detail),s},e.CustomEvent.prototype=e.Event.prototype),t.addEventListener("touchstart",(function(t){if(n&&console.log("Touch start"),n&&console.log(t.timeStamp),n&&console.log(`Touch start x + ${t.changedTouches.length} = ${t.touches.length}`),t.changedTouches.length<t.touches.length)return t.timeStamp-r.timestampStart1>=100?void(n&&console.log("Delayed second touch ignored")):void(r.timestampStart2=t.timeStamp);if("true"===d(t.target,"data-swipe-ignore","false"))return void(r.timestampStart1=-1);const s=t.touches[0];(r={idFinger1:s.identifier,timestampStart1:t.timeStamp,timestampStart2:t.changedTouches.length>1?t.timeStamp:null,xDown:s.screenX,yDown:s.screenY,targetStart:t.target}).scrollPositionsDown=[],l(r.scrollPositionsDown,t.target,t.currentTarget||e)}),!1),t.addEventListener("touchend",(function(c){n&&console.log(`Touch ${c.changedTouches[0].identifier==r.idFinger1?1:2} end ${c.changedTouches.length}`),n&&console.log(c.timeStamp),n&&console.log("TDiff: "+(c.timeStamp-r.timestampStart1));let u=!1;for(let t=0;t<c.changedTouches.length;++t)if(c.changedTouches[t].identifier===r.idFinger1){const n=c.changedTouches[t];r.xUp=n.screenX,r.yUp=n.screenY,r.timestampEnd1=c.timeStamp,r.touchType=n.touchType||"direct",r.scrollPositionsUp=[],l(r.scrollPositionsUp,c.target,c.currentTarget||e),u=!0;break}if(!1===u&&1===c.touches.length&&(r.timestampEnd2=c.timeStamp),0===c.touches.length){if(c.changedTouches.length>1&&(r.timestampEnd2=c.timeStamp),c.timeStamp-r.timestampEnd1>=100)return void(n&&console.log("First finger released too early. Ignore gesture"));!function(e){const n=r.targetStart;if(r.targetStart!==e.target)return;if(console.log(e),function(e,t){if(e.length!==t.length)return!0;for(let n=0;n<e.length;++n){const i=Math.abs(e[n][0]-t[n][0]),a=Math.abs(e[n][1]-t[n][1]);if(i>s||a>s)return!0}return!1}(r.scrollPositionsDown,r.scrollPositionsUp))return void console.log("Scrolled!!!!");var l=parseInt(d(n,"data-swipe-threshold","20"),10),c=d(n,"data-swipe-unit","px"),u=parseInt(d(n,"data-swipe-timeout","500"),10);"vh"===c&&(l=Math.round(l/100*t.documentElement.clientHeight)),"vw"===c&&(l=Math.round(l/100*t.documentElement.clientWidth));var p=function(e,t,n,s,i){if(Math.abs(e)<=s&&Math.abs(t)<=s)return null;if(n>=i)return null;const a=Math.atan2(t,e)*(4/Math.PI),r=Math.floor(a+.5+4);return o[r]}(r.xDown-r.xUp,r.yDown-r.yUp,r.timestampEnd1-r.timestampStart1,l,u);if(null!==p){var m={dir:p.replace(/swiped-/,""),touchType:r.touchType,xStart:parseInt(r.xDown,10),xEnd:parseInt(r.xUp,10),yStart:parseInt(r.yDown,10),yEnd:parseInt(r.yUp,10),fingers:r.timestampEnd2?2:1};a&&n.dispatchEvent(new CustomEvent("swiped",{bubbles:!0,cancelable:!0,detail:m})),i&&n.dispatchEvent(new CustomEvent(p,{bubbles:!0,cancelable:!0,detail:m}))}r={}}(c)}}),!1);const n=!1,s=50,i=!1,a=!0,o=["swiped-right",null,"swiped-down",null,"swiped-left",null,"swiped-up",null,"swiped-right"];var r=null;function l(e,t,n){let s=t;for(;s&&(e.push([s.scrollTop,s.scrollLeft]),(s=s.parentElement)!==n););}function d(e,n,s){for(;e&&e!==t.documentElement;){var i=e.getAttribute(n);if(i)return i;e=e.parentNode}return s}}(window,document);